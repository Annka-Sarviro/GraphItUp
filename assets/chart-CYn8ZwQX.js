import"./themeToggle-CJlD4QzU.js";function rt(){const t=document.getElementById("chartSVG-wrapper").outerHTML,n=document.getElementById("dataTable"),o=n.querySelectorAll("tr");let e;const s=o.length>0?o[0].outerHTML:"";if(o.length>7){const c=Array.from(n.querySelectorAll("tr.highlight"));e=`
      <table>
        <thead>${s}</thead>
        <tbody>${c.map(r=>r.outerHTML).join("")}</tbody>
      </table>
    `}else e=n.outerHTML;const l=window.open("","_blank");l.document.write(`
    <html>
      <head>
        <title>Print</title>
        <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0"
    />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet" />
        <link rel="stylesheet" type="text/css" href="/GraphItUp/assets/themeToggle-B6-LCn3U.css">
      </head>
      <body>
        <div id="print-content">

          ${t}

          ${e}
        </div>
      </body>
    </html>
  `),l.document.close(),l.onafterprint=function(){l.close()},l.print()}document.getElementById("printChart").addEventListener("click",()=>{rt()});function at(t,n="chart_table.pdf"){const o=t.cloneNode(!0);o.setAttribute("width",800),o.setAttribute("height",800);const e=document.createElement("canvas"),s=e.getContext("2d");e.width=800,e.height=800;const c=new XMLSerializer().serializeToString(o),r=new Image,a=new Blob([c],{type:"image/svg+xml;charset=utf-8"}),h=URL.createObjectURL(a);r.onload=()=>{s.drawImage(r,0,0),URL.revokeObjectURL(h);const i=window.open("","_blank");if(i){const m=e.toDataURL("image/png");i.document.write(`
        <html>
          <head>
            <title>${n}</title>
          </head>
          <body>
            <img src="${m}" style="width:100%;height:auto;">
          </body>
        </html>
      `),i.document.close(),i.onload=()=>{i.focus(),i.print(),i.onafterprint=()=>{i.close()}}}},r.onerror=i=>{console.error("Ошибка загрузки изображения",i)},r.src=h}function st(t,n="chart_table.png"){const o=t.cloneNode(!0);o.setAttribute("width",800),o.setAttribute("height",800);const e=document.createElement("canvas"),s=e.getContext("2d");e.width=800,e.height=800;const c=new XMLSerializer().serializeToString(o),r=new Image,a=new Blob([c],{type:"image/svg+xml;charset=utf-8"}),h=URL.createObjectURL(a);r.onload=()=>{s.drawImage(r,0,0),URL.revokeObjectURL(h),e.toBlob(i=>{const m=document.createElement("a");m.href=URL.createObjectURL(i),m.download=n,document.body.appendChild(m),m.click(),document.body.removeChild(m)},"image/png")},r.onerror=i=>{console.error("Ошибка загрузки изображения",i)},r.src=h}function ct(t,n){const o=t.cloneNode(!0);o.setAttribute("width",800),o.setAttribute("height",800);const s=new XMLSerializer().serializeToString(o),l=new Blob([s],{type:"image/svg+xml;charset=utf-8"}),c=URL.createObjectURL(l),r=document.createElement("a");r.href=c,r.download=n,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(c)}const Y=document.getElementById("chartSVG");document.getElementById("dataTable");document.getElementById("exportButton").addEventListener("click",()=>{const t=document.getElementById("selectedFormat").innerText;t==="PNG"?st(Y,"chart_table.png"):t==="SVG"?ct(Y,"chart.svg"):t==="PDF"?at(Y,"chart_table.pdf"):console.error("Непідтримуваний формат: "+t)});const K=document.getElementById("customLabel"),lt=document.getElementById("selectedFormat"),Z=document.getElementById("selectOptions"),j=document.querySelector(".arrow");K.addEventListener("click",()=>{Z.classList.toggle("show"),j.classList.toggle("rotate")});document.querySelectorAll("#selectOptions li").forEach(t=>{t.addEventListener("click",function(){lt.textContent=this.getAttribute("data-value"),j.classList.remove("rotate")})});document.addEventListener("click",function(t){K.contains(t.target)||(j.classList.remove("rotate"),Z.classList.remove("show"))});function q(t,n){const o=t.getAttribute("data-category"),e=t.getAttribute("data-year"),s=document.querySelectorAll("#dataTable td"),l=document.querySelectorAll("#dataTable  tr.highlight td");n?(t.style.cursor="pointer",t.setAttribute("stroke","var(--accent-color-hover)"),t.setAttribute("stroke-width","3"),l.length>0?l.forEach(c=>{const r=c.getAttribute("data-Y"),a=c.getAttribute("data-X");r===o&&a===e&&c.classList.add("highlight")}):s.forEach(c=>{const r=c.getAttribute("data-Y"),a=c.getAttribute("data-X");r===o&&a===e&&c.classList.add("highlight")})):(t.setAttribute("stroke","none"),t.setAttribute("stroke-width","initial"),s.forEach(c=>{c.classList.remove("highlight")}))}function it(t,n,o,e,s,l){const r=e.clientWidth-80,a=e.clientHeight-2*40,h=100,m=(r-60)/n.length*.8,p=Math.max(...t.flat().filter(L=>!isNaN(L)&&L!=="")),E=m*.2,u=parseInt(localStorage.getItem("gridSize"))||10,N=Math.floor(p/u);for(let L=0;L<=N;L++){const A=40+a-L*u*(a/p),w=document.createElementNS("http://www.w3.org/2000/svg","line");w.setAttribute("x1",40),w.setAttribute("y1",A),w.setAttribute("x2",r+40),w.setAttribute("y2",A),w.setAttribute("stroke","var(--grey)"),e.appendChild(w);const g=(L*u).toFixed(0),d=document.createElementNS("http://www.w3.org/2000/svg","text");d.setAttribute("x",30),d.setAttribute("y",A+5),d.setAttribute("fill","var(--text-color)"),d.textContent=g,e.appendChild(d)}t.forEach((L,A)=>{let w=h+A*(m+E);const g=L.map((d,f)=>({value:d,category:o[f]})).filter(({value:d})=>!isNaN(d)&&d!=="").sort((d,f)=>f.value-d.value);if(g.forEach(({value:d,category:f},S)=>{const x=d/p*a,v=document.createElementNS("http://www.w3.org/2000/svg","rect");v.setAttribute("data-category",f),v.setAttribute("data-year",n[A]);let I=(JSON.parse(localStorage.getItem("headerColors"))||{})[f];v.setAttribute("x",w),v.setAttribute("y",40+a-x),v.setAttribute("width",m),v.setAttribute("height",x),v.setAttribute("fill",I),e.appendChild(v),v.addEventListener("mouseenter",()=>{q(v,!0)}),v.addEventListener("mouseleave",()=>{q(v,!1)})}),g.forEach(({value:d},f)=>{if(!isNaN(d)&&d!==""){const S=d/p*a,x=document.createElementNS("http://www.w3.org/2000/svg","text");x.setAttribute("x",w+m/2),x.setAttribute("y",40+a-S-5),x.setAttribute("fill","#000"),x.textContent=d.toFixed(0),x.setAttribute("text-anchor","middle"),e.appendChild(x)}}),n[A]!==""){const d=document.createElementNS("http://www.w3.org/2000/svg","text");d.setAttribute("x",w+m/2),d.setAttribute("y",e.clientHeight-40+15),d.setAttribute("fill","var(--text-color)"),d.textContent=n[A],d.setAttribute("text-anchor","middle"),e.appendChild(d)}});const C=document.createElementNS("http://www.w3.org/2000/svg","text");C.setAttribute("x",e.clientWidth/2),C.setAttribute("y",e.clientHeight-40+40),C.setAttribute("fill","var(--text-color)"),C.textContent=s,C.setAttribute("text-anchor","middle"),e.appendChild(C)}function dt(t,n,o,e,s,l,c=300){const a=t[0].map(i=>parseInt(i)).filter(i=>!isNaN(i)&&i!=="").reduce((i,m)=>i+m,0);if(a===0){console.error("Total is zero. Cannot render pie chart.");return}let h=0;t[0].forEach((i,m)=>{const p=i/a*2*Math.PI,E=e.clientWidth/2,u=e.clientHeight/2,N=E+c*Math.cos(h),C=u+c*Math.sin(h),L=E+c*Math.cos(h+p),A=u+c*Math.sin(h+p),w=`M ${E} ${u} L ${N} ${C} A ${c} ${c} 0 ${p>Math.PI?1:0} 1 ${L} ${A} Z`,g=document.createElementNS("http://www.w3.org/2000/svg","path"),d=JSON.parse(localStorage.getItem("headerColors"))||{},f=o[m];let S=d[f];if(g.setAttribute("d",w),g.setAttribute("fill",S),g.setAttribute("data-category",o[m]),g.setAttribute("data-year",n[0]),g.addEventListener("mouseenter",()=>{q(g,!0)}),g.addEventListener("mouseleave",()=>{q(g,!1)}),e.appendChild(g),i!==0){const v=h+p/2,T=E+(c+20)*Math.cos(v),I=u+(c+20)*Math.sin(v),b=document.createElementNS("http://www.w3.org/2000/svg","text");b.setAttribute("x",T),b.setAttribute("y",I),b.setAttribute("fill","var(--text-color)"),b.setAttribute("text-anchor","middle"),b.textContent=i,e.appendChild(b)}h+=p;const x=document.createElementNS("http://www.w3.org/2000/svg","text");x.setAttribute("x",e.clientWidth/2),x.setAttribute("y",u+c+40),x.setAttribute("fill","var(--text-color)"),x.setAttribute("text-anchor","middle"),x.textContent=`${n[0]}  ${s}`,e.appendChild(x)})}function gt(t,n,o,e,s,l){e.innerHTML="";const r=(JSON.parse(localStorage.getItem("chartData"))||[])[0].slice(1),a=40,h=e.clientWidth-2*a,i=e.clientHeight-2*a,m=Math.max(...t.flat()),p=parseInt(localStorage.getItem("gridSize"))||10,E=Math.floor(m/p),u=h/(t[0].length+1),N=i/m;for(let w=0;w<=E;w++){const g=a+i-w*p*N,d=document.createElementNS("http://www.w3.org/2000/svg","line");d.setAttribute("x1",a),d.setAttribute("y1",g),d.setAttribute("x2",h+a),d.setAttribute("y2",g),d.setAttribute("stroke","var(--grey)"),e.appendChild(d);const f=(w*p).toFixed(0),S=document.createElementNS("http://www.w3.org/2000/svg","text");S.setAttribute("x",a-10),S.setAttribute("y",g+5),S.setAttribute("fill","var(--text-color)"),S.textContent=f,e.appendChild(S)}const C=document.createElementNS("http://www.w3.org/2000/svg","g");t[0].forEach((w,g)=>{const d=a+u*(g+1),f=document.createElementNS("http://www.w3.org/2000/svg","line");f.setAttribute("x1",d),f.setAttribute("y1",a),f.setAttribute("x2",d),f.setAttribute("y2",i+a),f.setAttribute("stroke","var(--grey)"),C.appendChild(f)}),e.insertBefore(C,e.firstChild),t[0].map((w,g)=>t.map(d=>d[g])).forEach((w,g)=>{const d=JSON.parse(localStorage.getItem("headerColors"))||{},f=o[g];let S=d[f],x="",v=!1;w.forEach((b,k)=>{if(b==null||isNaN(b)||!b){v=!1;return}const P=a+u*(k+1),y=a+i-b*N;v?x+=`L ${P} ${y} `:(x+=`M ${P} ${y} `,v=!0)});const T=document.createElementNS("http://www.w3.org/2000/svg","path");T.setAttribute("d",x),T.setAttribute("stroke",S),T.setAttribute("fill","none"),T.setAttribute("stroke-width","2"),T.setAttribute("data-category",o[g]),e.appendChild(T);const I=document.createElementNS("http://www.w3.org/2000/svg","path");I.setAttribute("d",x),I.setAttribute("stroke","transparent"),I.setAttribute("fill","none"),I.setAttribute("stroke-width","12"),I.style.cursor="pointer",e.appendChild(I),w.forEach((b="",k)=>{if(b){const P=a+u*(k+1),y=document.createElementNS("http://www.w3.org/2000/svg","text");y.setAttribute("x",P),y.setAttribute("y",a+i-b*N-10),y.setAttribute("fill","var(--text-color)"),y.setAttribute("text-anchor","middle"),y.textContent=b||"",y.classList.add("hover-text"),e.appendChild(y)}}),I.addEventListener("mouseover",function(){T.setAttribute("stroke-width","4");const b=r.indexOf(o[g]),k=document.querySelectorAll("#dataTable tr.highlight"),P=document.querySelectorAll("#dataTable tr");k.length>0?k.forEach(y=>{const $=y.querySelector(`td:nth-child(${b+2})`);$&&$.classList.add("extra")}):P.forEach(y=>{const $=y.querySelector(`td:nth-child(${b+2})`);$&&$.classList.add("extra")})}),I.addEventListener("mouseout",function(){T.setAttribute("stroke-width","2");const b=r.indexOf(o[g]);t.length<=6&&document.querySelectorAll("#dataTable tr").forEach(y=>{const $=y.querySelector(`td:nth-child(${b+2})`);$&&$.classList.remove("extra")}),document.querySelectorAll("#dataTable .highlight").forEach((P,y)=>{y===b&&P.classList.remove("extra")})}),w.forEach((b,k)=>{if(typeof b=="number"&&!isNaN(b)){const P=a+u*(k+1),y=document.createElementNS("http://www.w3.org/2000/svg","circle");y.setAttribute("cx",P),y.setAttribute("cy",a+i-b*N),y.setAttribute("r",5),y.setAttribute("fill",S),y.setAttribute("data-category",o[g]),e.appendChild(y)}})}),t[0].forEach((w,g)=>{const d=a+u*(g+1),f=document.createElementNS("http://www.w3.org/2000/svg","text");f.setAttribute("x",d),f.setAttribute("y",e.clientHeight-a+15),f.setAttribute("fill","var(--text-color)"),f.textContent=n[g],f.setAttribute("text-anchor","middle"),e.appendChild(f)});const A=document.createElementNS("http://www.w3.org/2000/svg","text");A.setAttribute("x",e.clientWidth/2),A.setAttribute("y",e.clientHeight-10),A.setAttribute("fill","#000"),A.textContent=s,e.appendChild(A)}function ut(t,n,o,e,s,l,c){t==="bar"?it(n,o,e,s,l):t==="pie"?dt(n,o,e,s,l):t==="line"?gt(n,o,e,s,l):console.error("Unknown chart type")}function ht(t,n){if(!t)return"rgba(0, 0, 0, 0)";const o=parseInt(t.slice(1),16),e=Math.round(2.55*n),s=(o>>16)+e,l=(o>>8&255)+e,c=(o&255)+e;return`#${(16777216+(s<255?s<1?0:s:255)*65536+(l<255?l<1?0:l:255)*256+(c<255?c<1?0:c:255)).toString(16).slice(1)}`}function mt(t,n,o="bar"){const e=document.getElementById("legend");e.innerHTML="";const s=JSON.parse(localStorage.getItem("headerColors"))||{};t.forEach((l,c)=>{const r=document.createElement("div");r.style.display="flex",r.style.alignItems="center",r.style.marginBottom="5px",r.style.cursor="pointer";const a=document.createElement("div");a.style.width="15px",a.style.minWidth="15px",a.style.height="15px";const h=s[l]||"#cccccc";a.style.backgroundColor=h,a.style.marginRight="10px";const i=document.createElement("span");i.textContent=l,r.appendChild(a),r.appendChild(i),r.addEventListener("mouseenter",()=>{X(l,!0,o)}),r.addEventListener("mouseleave",()=>{X(l,!1,o)}),e.appendChild(r)})}function X(t,n,o="bar"){document.querySelectorAll("rect, path").forEach(s=>{s.getAttribute("data-category")===t&&(n?o==="line"?s.setAttribute("stroke-width","4"):(s.setAttribute("stroke-width","3"),s.style.stroke="var(--accent-color-hover)"):o==="line"?s.setAttribute("stroke-width","2"):s.setAttribute("stroke-width","0"))})}function pt(t){const n=t[0],o=[],e=n.slice(1).map((s,l)=>!t.slice(1).every(r=>isNaN(r[l+1])));return t.forEach(s=>{const l=s.filter((c,r)=>r===0||e[r-1]);o.push(l)}),o}function ft(t){const n=getComputedStyle(document.body).getPropertyValue("--one-color").trim(),o=getComputedStyle(document.body).getPropertyValue("--two-color").trim(),e=getComputedStyle(document.body).getPropertyValue("--three-color").trim(),s=getComputedStyle(document.body).getPropertyValue("--four-color").trim(),l=getComputedStyle(document.body).getPropertyValue("--five-color").trim(),c=[n,o,e,s,l],r={};t.filter(a=>a!=="error-undefined").forEach((a,h)=>{let i;if(a!=="error-undefined"){if(h<5)i=c[h];else{const m=c[h%5];i=ht(m,-20*Math.floor(h/5))}r[a]=i}}),localStorage.setItem("headerColors",JSON.stringify(r))}const bt=6;function H(t){const n=document.getElementById("dataTable");n.innerHTML="";let o=parseInt(localStorage.getItem("currentPage"));const s=(localStorage.getItem("chartType")||"bar")==="pie"?1:bt,l=t.length,c=t[0],r=document.createElement("tr"),h=t.map(p=>p.map((E,u)=>t.every(C=>isNaN(C[u])||C[u]==="")?"error-undefined":E))[0].slice(1);ft(h),c.forEach(p=>{const E=document.createElement("th");E.textContent=p,r.appendChild(E)}),n.appendChild(r);const i=(o-1)*s+1,m=i+s;for(let p=1;p<l;p++){const E=t[p],u=document.createElement("tr");p>=i&&p<m&&l>s&&u.classList.add("highlight"),E.forEach((C,L)=>{const A=document.createElement("td");A.textContent=C,A.setAttribute("data-X",E[0]),A.setAttribute("data-Y",c[L]),u.appendChild(A)}),n.appendChild(u)}}const Q=document.getElementById("chartLoader"),V=document.querySelector(".chartSVG-wrapper");let _=parseInt(localStorage.getItem("currentPage")),yt=localStorage.getItem("chartType");const G=6,U=JSON.parse(localStorage.getItem("chartData"))||[],R=U.map(t=>t.filter((n,o)=>U.some(e=>!isNaN(e[o])&&e[o]!=="")));_||(_=1,localStorage.setItem("currentPage",_));function wt(){Q.style.display="block",V.classList.add("blurred")}function At(){Q.style.display="none",V.classList.remove("blurred")}function z(){const t=localStorage.getItem("chartType");let n=parseInt(localStorage.getItem("currentPage"));wt();const o=t==="pie"?1:G,e=(n-1)*o+1,s=R.slice(e,e+o),l=R.slice(0)[0][0],c=s.length>0?s[0][1]:"",a=pt(R)[0].slice(1).map(u=>u===""?"":u),h=s.map(u=>u[0]),i=s.map(u=>u.slice(1));setTimeout(()=>{chartSVG.innerHTML="",ut(t,i,h,a,chartSVG,l),mt(a,c,t),At()},1500);const m=document.getElementById("scale-wrapper");t==="pie"?m.style.display="none":m.style.display="flex";const p=document.getElementById("pagination"),E=yt==="pie"?R.length-1:Math.ceil((R.length-1)/o);E>1?(p.style.display="flex",document.getElementById("pageInfo").innerText=`${n} з ${E}`):p.style.display="none"}function tt(t){const n=localStorage.getItem("chartType");let o=parseInt(localStorage.getItem("currentPage"));const e=n==="pie"?1:G,s=document.getElementById("pagination"),l=n==="pie"?R.length-1:Math.ceil(R.length/e),c=o+t;l>1?s.style.display="flex":s.style.display="none",c<1?localStorage.setItem("currentPage",1):c>l?localStorage.setItem("currentPage",l):localStorage.setItem("currentPage",c),z(),H(U);let r=localStorage.getItem("currentPage");document.getElementById("pageInfo").innerText=`${r} з ${l}`}const F=document.getElementById("prevBtn"),J=document.getElementById("nextBtn");F.dataset.eventAttached||(F.addEventListener("click",t=>{console.log("Prev button clicked"),t.preventDefault(),tt(-1)}),F.dataset.eventAttached=!0);J.dataset.eventAttached||(J.addEventListener("click",t=>{console.log("Next button clicked"),t.preventDefault(),tt(1)}),J.dataset.eventAttached=!0);H(U);z();const et=JSON.parse(localStorage.getItem("chartData"))||[];let M=localStorage.getItem("chartType");M||(M="bar",localStorage.setItem("chartType",M));const ot=document.querySelectorAll('input[name="chartType"]');ot.forEach(t=>{t.value===M&&(t.checked=!0)});ot.forEach(t=>{t.addEventListener("change",n=>{localStorage.setItem("currentPage",1),M=n.target.value,localStorage.setItem("chartType",M),z(),H(et)})});const xt=document.querySelectorAll(".type-wrapper label");xt.forEach(t=>{t.addEventListener("click",()=>{const n=document.getElementById(t.getAttribute("for"));n&&(localStorage.setItem("currentPage",1),n.checked=!0,M=n.value,localStorage.setItem("chartType",M),z(),H(et))})});let B=localStorage.getItem("gridSize")||10;const D=document.getElementById("scale-toggle"),O=document.getElementById("scale-menu");B&&(D.value=B);D.addEventListener("click",()=>{O.classList.toggle("hidden")});for(let t=10;t<=500;t+=10){const n=document.createElement("li");n.textContent=t,n.addEventListener("click",()=>{D.value=t,B=t,localStorage.setItem("gridSize",B),localStorage.getItem("chartType"),z(),O.classList.add("hidden"),console.log("Selected gridSize:",B)}),O.appendChild(n)}D.addEventListener("input",t=>{B=t.target.value,console.log("Entered gridSize:",B)});D.addEventListener("keydown",t=>{t.key==="Enter"&&(localStorage.setItem("gridSize",B),localStorage.getItem("chartType"),z(),O.classList.add("hidden"),console.log("GridSize saved and dropdown closed on Enter:",B))});document.addEventListener("click",function(t){!D.contains(t.target)&&!O.contains(t.target)&&O.classList.add("hidden")});const Et=JSON.parse(localStorage.getItem("chartData"))||[],nt=document.getElementById("palette-btn"),W=document.getElementById("palette-dropdown");nt.addEventListener("click",function(t){W.classList.toggle("hidden"),t.stopPropagation()});document.querySelectorAll("#palette-dropdown li").forEach(function(t){t.addEventListener("click",function(){W.classList.add("hidden")})});document.addEventListener("click",function(t){!W.classList.contains("hidden")&&!nt.contains(t.target)&&W.classList.add("hidden")});document.querySelectorAll("#palette-dropdown li").forEach(function(t){t.addEventListener("click",function(){document.querySelectorAll("#palette-dropdown .dropdown-item").forEach(function(o){o.classList.remove("active")}),this.classList.add("active");const n=this.getAttribute("data-palette");document.body.className=document.body.className.replace(/\bpalette-\S+/g,""),document.body.classList.add(`palette-${n}`),localStorage.getItem("chartType"),H(Et),z(),document.getElementById("palette-dropdown").classList.add("hidden")})});
