import"./themeToggle-vR9Xt0bv.js";function at(){const t=document.getElementById("chartSVG-wrapper").outerHTML,o=document.getElementById("dataTable"),r=o.querySelectorAll("tr");let e;const n=r.length>0?r[0].outerHTML:"";if(r.length>7){const s=Array.from(o.querySelectorAll("tr.highlight"));e=`
      <table>
        <thead>${n}</thead>
        <tbody>${s.map(l=>l.outerHTML).join("")}</tbody>
      </table>
    `}else e=o.outerHTML;const c=window.open("","_blank");c.document.write(`
    <html>
      <head>
        <title>Print</title>
        <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0"
    />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet" />
        <link rel="stylesheet" type="text/css" href="https://Annka-Sarviro.github.io/GraphItUp/src/styles.css">
      </head>
      <body>
        <div id="print-content">

          ${t}

          ${e}
        </div>
      </body>
    </html>
  `),c.document.close(),c.onafterprint=function(){c.close()},c.print()}document.getElementById("printChart").addEventListener("click",()=>{at()});function st(t,o,r="chart_table.png"){const e=document.createElement("canvas"),n=e.getContext("2d"),c=t.clientWidth,s=t.clientHeight,l=new XMLSerializer().serializeToString(t),a=new Blob([l],{type:"image/svg+xml"}),m=URL.createObjectURL(a),g=new Image;g.crossOrigin="anonymous",g.onload=function(){const w=o.offsetHeight;e.width=Math.max(c,o.offsetWidth),e.height=s+w,n.drawImage(g,0,0);const u=new XMLSerializer().serializeToString(o),A=new Blob([u],{type:"image/svg+xml"}),d=URL.createObjectURL(A),S=new Image;S.crossOrigin="anonymous",S.onload=function(){n.drawImage(S,0,s),e.toBlob(function(E){if(E){const L=URL.createObjectURL(E),p=document.createElement("a");p.href=L,p.download=r,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(L)}else console.error("Не удалось создать Blob из canvas.")},"image/png"),URL.revokeObjectURL(d)},S.src=d},g.src=m,g.onerror=function(){console.error("Ошибка загрузки изображения SVG.")}}function ct(t,o,r){const e=t.cloneNode(!0),n=document.createElementNS("http://www.w3.org/2000/svg","svg"),c=t.clientWidth,s=t.clientHeight+o.clientHeight;n.setAttribute("width",c),n.setAttribute("height",s),n.setAttribute("xmlns","http://www.w3.org/2000/svg"),n.appendChild(e);const l=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");l.setAttribute("x",0),l.setAttribute("y",s-o.clientHeight),l.setAttribute("width",c),l.setAttribute("height",o.clientHeight);const a=o.cloneNode(!0),m=document.createElement("div");m.appendChild(a),l.appendChild(m),n.appendChild(l);const w=new XMLSerializer().serializeToString(n),u=new Blob([w],{type:"image/svg+xml;charset=utf-8"}),A=URL.createObjectURL(u),d=document.createElement("a");d.href=A,d.download=r,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(A)}const F=document.getElementById("chartSVG"),K=document.getElementById("dataTable");document.getElementById("exportButton").addEventListener("click",()=>{const t=document.getElementById("exportSelect").value;console.log(t),t==="png"?st(F,K,"chart_table.png"):t==="svg"&&ct(F,K,"chart.svg")});const Q=document.getElementById("customLabel"),lt=document.getElementById("selectedFormat"),_=document.getElementById("selectOptions"),X=document.querySelector(".arrow");Q.addEventListener("click",()=>{_.classList.toggle("show"),X.classList.toggle("rotate")});document.querySelectorAll("#selectOptions div").forEach(t=>{t.addEventListener("click",function(){lt.textContent=this.getAttribute("data-value"),X.classList.remove("rotate"),_.classList.remove("show")})});document.addEventListener("click",function(t){Q.contains(t.target)||(X.classList.remove("rotate"),_.classList.remove("show"))});function q(t,o){const r=t.getAttribute("data-category"),e=t.getAttribute("data-year"),n=document.querySelectorAll("#dataTable td"),c=document.querySelectorAll("#dataTable  tr.highlight td");o?(t.style.cursor="pointer",t.setAttribute("stroke","var(--accent-color-hover)"),t.setAttribute("stroke-width","3"),c.length>0?c.forEach(s=>{const l=s.getAttribute("data-Y"),a=s.getAttribute("data-X");l===r&&a===e&&s.classList.add("highlight")}):n.forEach(s=>{const l=s.getAttribute("data-Y"),a=s.getAttribute("data-X");l===r&&a===e&&s.classList.add("highlight")})):(t.setAttribute("stroke","none"),t.setAttribute("stroke-width","initial"),n.forEach(s=>{s.classList.remove("highlight")}))}function it(t,o,r,e,n,c){const l=e.clientWidth-80,a=e.clientHeight-2*40,m=100,w=(l-60)/o.length*.8,u=Math.max(...t.flat().filter(L=>!isNaN(L)&&L!=="")),A=w*.2,d=parseInt(localStorage.getItem("gridSize"))||10,S=Math.floor(u/d);for(let L=0;L<=S;L++){const p=40+a-L*d*(a/u),x=document.createElementNS("http://www.w3.org/2000/svg","line");x.setAttribute("x1",40),x.setAttribute("y1",p),x.setAttribute("x2",l+40),x.setAttribute("y2",p),x.setAttribute("stroke","var(--grey)"),e.appendChild(x);const h=(L*d).toFixed(0),i=document.createElementNS("http://www.w3.org/2000/svg","text");i.setAttribute("x",30),i.setAttribute("y",p+5),i.setAttribute("fill","var(--text-color)"),i.textContent=h,e.appendChild(i)}t.forEach((L,p)=>{let x=m+p*(w+A);const h=L.map((i,f)=>({value:i,category:r[f]})).filter(({value:i})=>!isNaN(i)&&i!=="").sort((i,f)=>f.value-i.value);if(h.forEach(({value:i,category:f},I)=>{const v=i/u*a,C=document.createElementNS("http://www.w3.org/2000/svg","rect");C.setAttribute("data-category",f),C.setAttribute("data-year",o[p]);let T=(JSON.parse(localStorage.getItem("headerColors"))||{})[f];C.setAttribute("x",x),C.setAttribute("y",40+a-v),C.setAttribute("width",w),C.setAttribute("height",v),C.setAttribute("fill",T),e.appendChild(C),C.addEventListener("mouseenter",()=>{q(C,!0)}),C.addEventListener("mouseleave",()=>{q(C,!1)})}),h.forEach(({value:i},f)=>{if(!isNaN(i)&&i!==""){const I=i/u*a,v=document.createElementNS("http://www.w3.org/2000/svg","text");v.setAttribute("x",x+w/2),v.setAttribute("y",40+a-I-5),v.setAttribute("fill","#000"),v.textContent=i.toFixed(0),v.setAttribute("text-anchor","middle"),e.appendChild(v)}}),o[p]!==""){const i=document.createElementNS("http://www.w3.org/2000/svg","text");i.setAttribute("x",x+w/2),i.setAttribute("y",e.clientHeight-40+15),i.setAttribute("fill","var(--text-color)"),i.textContent=o[p],i.setAttribute("text-anchor","middle"),e.appendChild(i)}});const E=document.createElementNS("http://www.w3.org/2000/svg","text");E.setAttribute("x",e.clientWidth/2),E.setAttribute("y",e.clientHeight-40+40),E.setAttribute("fill","var(--text-color)"),E.textContent=n,E.setAttribute("text-anchor","middle"),e.appendChild(E)}function dt(t,o,r,e,n,c,s=300){const a=t[0].map(g=>parseInt(g)).filter(g=>!isNaN(g)&&g!=="").reduce((g,w)=>g+w,0);if(a===0){console.error("Total is zero. Cannot render pie chart.");return}let m=0;t[0].forEach((g,w)=>{const u=g/a*2*Math.PI,A=e.clientWidth/2,d=e.clientHeight/2,S=A+s*Math.cos(m),E=d+s*Math.sin(m),L=A+s*Math.cos(m+u),p=d+s*Math.sin(m+u),x=`M ${A} ${d} L ${S} ${E} A ${s} ${s} 0 ${u>Math.PI?1:0} 1 ${L} ${p} Z`,h=document.createElementNS("http://www.w3.org/2000/svg","path"),i=JSON.parse(localStorage.getItem("headerColors"))||{},f=r[w];let I=i[f];if(h.setAttribute("d",x),h.setAttribute("fill",I),h.setAttribute("data-category",r[w]),h.setAttribute("data-year",o[0]),h.addEventListener("mouseenter",()=>{q(h,!0)}),h.addEventListener("mouseleave",()=>{q(h,!1)}),e.appendChild(h),g!==0){const C=m+u/2,N=A+(s+20)*Math.cos(C),T=d+(s+20)*Math.sin(C),b=document.createElementNS("http://www.w3.org/2000/svg","text");b.setAttribute("x",N),b.setAttribute("y",T),b.setAttribute("fill","var(--text-color)"),b.setAttribute("text-anchor","middle"),b.textContent=g,e.appendChild(b)}m+=u;const v=document.createElementNS("http://www.w3.org/2000/svg","text");v.setAttribute("x",e.clientWidth/2),v.setAttribute("y",d+s+40),v.setAttribute("fill","var(--text-color)"),v.setAttribute("text-anchor","middle"),v.textContent=`${o[0]}  ${n}`,e.appendChild(v)})}function gt(t,o,r,e,n,c){e.innerHTML="";const l=(JSON.parse(localStorage.getItem("chartData"))||[])[0].slice(1),a=40,m=e.clientWidth-2*a,g=e.clientHeight-2*a,w=Math.max(...t.flat()),u=parseInt(localStorage.getItem("gridSize"))||10,A=Math.floor(w/u),d=m/(t[0].length+1),S=g/w;for(let x=0;x<=A;x++){const h=a+g-x*u*S,i=document.createElementNS("http://www.w3.org/2000/svg","line");i.setAttribute("x1",a),i.setAttribute("y1",h),i.setAttribute("x2",m+a),i.setAttribute("y2",h),i.setAttribute("stroke","var(--grey)"),e.appendChild(i);const f=(x*u).toFixed(0),I=document.createElementNS("http://www.w3.org/2000/svg","text");I.setAttribute("x",a-10),I.setAttribute("y",h+5),I.setAttribute("fill","var(--text-color)"),I.textContent=f,e.appendChild(I)}const E=document.createElementNS("http://www.w3.org/2000/svg","g");t[0].forEach((x,h)=>{const i=a+d*(h+1),f=document.createElementNS("http://www.w3.org/2000/svg","line");f.setAttribute("x1",i),f.setAttribute("y1",a),f.setAttribute("x2",i),f.setAttribute("y2",g+a),f.setAttribute("stroke","var(--grey)"),E.appendChild(f)}),e.insertBefore(E,e.firstChild),t[0].map((x,h)=>t.map(i=>i[h])).forEach((x,h)=>{const i=JSON.parse(localStorage.getItem("headerColors"))||{},f=r[h];let I=i[f],v="",C=!1;x.forEach((b,P)=>{if(b==null||isNaN(b)||!b){C=!1;return}const k=a+d*(P+1),y=a+g-b*S;C?v+=`L ${k} ${y} `:(v+=`M ${k} ${y} `,C=!0)});const N=document.createElementNS("http://www.w3.org/2000/svg","path");N.setAttribute("d",v),N.setAttribute("stroke",I),N.setAttribute("fill","none"),N.setAttribute("stroke-width","2"),N.setAttribute("data-category",r[h]),e.appendChild(N);const T=document.createElementNS("http://www.w3.org/2000/svg","path");T.setAttribute("d",v),T.setAttribute("stroke","transparent"),T.setAttribute("fill","none"),T.setAttribute("stroke-width","12"),T.style.cursor="pointer",e.appendChild(T),x.forEach((b="",P)=>{if(b){const k=a+d*(P+1),y=document.createElementNS("http://www.w3.org/2000/svg","text");y.setAttribute("x",k),y.setAttribute("y",a+g-b*S-10),y.setAttribute("fill","var(--text-color)"),y.setAttribute("text-anchor","middle"),y.textContent=b||"",y.classList.add("hover-text"),e.appendChild(y)}}),T.addEventListener("mouseover",function(){N.setAttribute("stroke-width","4");const b=l.indexOf(r[h]),P=document.querySelectorAll("#dataTable tr.highlight"),k=document.querySelectorAll("#dataTable tr");P.length>0?P.forEach(y=>{const M=y.querySelector(`td:nth-child(${b+2})`);M&&M.classList.add("extra")}):k.forEach(y=>{const M=y.querySelector(`td:nth-child(${b+2})`);M&&M.classList.add("extra")})}),T.addEventListener("mouseout",function(){N.setAttribute("stroke-width","2");const b=l.indexOf(r[h]);t.length<=6&&document.querySelectorAll("#dataTable tr").forEach(y=>{const M=y.querySelector(`td:nth-child(${b+2})`);M&&M.classList.remove("extra")}),document.querySelectorAll("#dataTable .highlight").forEach((k,y)=>{y===b&&k.classList.remove("extra")})}),x.forEach((b,P)=>{if(typeof b=="number"&&!isNaN(b)){const k=a+d*(P+1),y=document.createElementNS("http://www.w3.org/2000/svg","circle");y.setAttribute("cx",k),y.setAttribute("cy",a+g-b*S),y.setAttribute("r",5),y.setAttribute("fill",I),y.setAttribute("data-category",r[h]),e.appendChild(y)}})}),t[0].forEach((x,h)=>{const i=a+d*(h+1),f=document.createElementNS("http://www.w3.org/2000/svg","text");f.setAttribute("x",i),f.setAttribute("y",e.clientHeight-a+15),f.setAttribute("fill","var(--text-color)"),f.textContent=o[h],f.setAttribute("text-anchor","middle"),e.appendChild(f)});const p=document.createElementNS("http://www.w3.org/2000/svg","text");p.setAttribute("x",e.clientWidth/2),p.setAttribute("y",e.clientHeight-10),p.setAttribute("fill","#000"),p.textContent=n,e.appendChild(p)}function ut(t,o,r,e,n,c,s){t==="bar"?it(o,r,e,n,c):t==="pie"?dt(o,r,e,n,c):t==="line"?gt(o,r,e,n,c):console.error("Unknown chart type")}function ht(t,o){if(!t)return"rgba(0, 0, 0, 0)";const r=parseInt(t.slice(1),16),e=Math.round(2.55*o),n=(r>>16)+e,c=(r>>8&255)+e,s=(r&255)+e;return`#${(16777216+(n<255?n<1?0:n:255)*65536+(c<255?c<1?0:c:255)*256+(s<255?s<1?0:s:255)).toString(16).slice(1)}`}function mt(t,o,r="bar"){const e=document.getElementById("legend");e.innerHTML="";const n=JSON.parse(localStorage.getItem("headerColors"))||{};t.forEach((c,s)=>{const l=document.createElement("div");l.style.display="flex",l.style.alignItems="center",l.style.marginBottom="5px",l.style.cursor="pointer";const a=document.createElement("div");a.style.width="15px",a.style.minWidth="15px",a.style.height="15px";const m=n[c]||"#cccccc";a.style.backgroundColor=m,a.style.marginRight="10px";const g=document.createElement("span");g.textContent=c,l.appendChild(a),l.appendChild(g),l.addEventListener("mouseenter",()=>{Z(c,!0,r)}),l.addEventListener("mouseleave",()=>{Z(c,!1,r)}),e.appendChild(l)})}function Z(t,o,r="bar"){document.querySelectorAll("rect, path").forEach(n=>{n.getAttribute("data-category")===t&&(o?r==="line"?n.setAttribute("stroke-width","4"):(n.setAttribute("stroke-width","3"),n.style.stroke="var(--accent-color-hover)"):r==="line"?n.setAttribute("stroke-width","2"):n.setAttribute("stroke-width","0"))})}function pt(t){const o=t[0],r=[],e=o.slice(1).map((n,c)=>!t.slice(1).every(l=>isNaN(l[c+1])));return t.forEach(n=>{const c=n.filter((s,l)=>l===0||e[l-1]);r.push(c)}),r}function ft(t){const o=getComputedStyle(document.body).getPropertyValue("--one-color").trim(),r=getComputedStyle(document.body).getPropertyValue("--two-color").trim(),e=getComputedStyle(document.body).getPropertyValue("--three-color").trim(),n=getComputedStyle(document.body).getPropertyValue("--four-color").trim(),c=getComputedStyle(document.body).getPropertyValue("--five-color").trim(),s=[o,r,e,n,c],l={};t.filter(a=>a!=="error-undefined").forEach((a,m)=>{let g;if(a!=="error-undefined"){if(m<5)g=s[m];else{const w=s[m%5];g=ht(w,-20*Math.floor(m/5))}l[a]=g}}),localStorage.setItem("headerColors",JSON.stringify(l))}const bt=6;function D(t){const o=document.getElementById("dataTable");o.innerHTML="";let r=parseInt(localStorage.getItem("currentPage"));const n=(localStorage.getItem("chartType")||"bar")==="pie"?1:bt,c=t.length,s=t[0],l=document.createElement("tr"),m=t.map(u=>u.map((A,d)=>t.every(E=>isNaN(E[d])||E[d]==="")?"error-undefined":A))[0].slice(1);ft(m),s.forEach(u=>{const A=document.createElement("th");A.textContent=u,l.appendChild(A)}),o.appendChild(l);const g=(r-1)*n+1,w=g+n;for(let u=1;u<c;u++){const A=t[u],d=document.createElement("tr");u>=g&&u<w&&c>n&&d.classList.add("highlight"),A.forEach((E,L)=>{const p=document.createElement("td");p.textContent=E,p.setAttribute("data-X",A[0]),p.setAttribute("data-Y",s[L]),d.appendChild(p)}),o.appendChild(d)}}const V=document.getElementById("chartLoader"),G=document.querySelector(".chartSVG-wrapper");let Y=parseInt(localStorage.getItem("currentPage")),yt=localStorage.getItem("chartType");const tt=6,W=JSON.parse(localStorage.getItem("chartData"))||[],O=W.map(t=>t.filter((o,r)=>W.some(e=>!isNaN(e[r])&&e[r]!=="")));Y||(Y=1,localStorage.setItem("currentPage",Y));function wt(){V.style.display="block",G.classList.add("blurred")}function At(){V.style.display="none",G.classList.remove("blurred")}function H(){const t=localStorage.getItem("chartType");let o=parseInt(localStorage.getItem("currentPage"));wt();const r=t==="pie"?1:tt,e=(o-1)*r+1,n=O.slice(e,e+r),c=O.slice(0)[0][0],s=n.length>0?n[0][1]:"",a=pt(O)[0].slice(1).map(d=>d===""?"":d),m=n.map(d=>d[0]),g=n.map(d=>d.slice(1));setTimeout(()=>{chartSVG.innerHTML="",ut(t,g,m,a,chartSVG,c),mt(a,s,t),At()},1500);const w=document.getElementById("scale-wrapper");t==="pie"?w.style.display="none":w.style.display="flex";const u=document.getElementById("pagination"),A=yt==="pie"?O.length-1:Math.ceil((O.length-1)/r);A>1?(u.style.display="flex",document.getElementById("pageInfo").innerText=`${o} з ${A}`):u.style.display="none"}function et(t){const o=localStorage.getItem("chartType");let r=parseInt(localStorage.getItem("currentPage"));const e=o==="pie"?1:tt,n=document.getElementById("pagination"),c=o==="pie"?O.length-1:Math.ceil(O.length/e),s=r+t;c>1?n.style.display="flex":n.style.display="none",s<1?localStorage.setItem("currentPage",1):s>c?localStorage.setItem("currentPage",c):localStorage.setItem("currentPage",s),H(),D(W);let l=localStorage.getItem("currentPage");document.getElementById("pageInfo").innerText=`${l} з ${c}`}const j=document.getElementById("prevBtn"),J=document.getElementById("nextBtn");j.dataset.eventAttached||(j.addEventListener("click",t=>{console.log("Prev button clicked"),t.preventDefault(),et(-1)}),j.dataset.eventAttached=!0);J.dataset.eventAttached||(J.addEventListener("click",t=>{console.log("Next button clicked"),t.preventDefault(),et(1)}),J.dataset.eventAttached=!0);D(W);H();const ot=JSON.parse(localStorage.getItem("chartData"))||[];let $=localStorage.getItem("chartType");$||($="bar",localStorage.setItem("chartType",$));const nt=document.querySelectorAll('input[name="chartType"]');nt.forEach(t=>{t.value===$&&(t.checked=!0)});nt.forEach(t=>{t.addEventListener("change",o=>{localStorage.setItem("currentPage",1),$=o.target.value,localStorage.setItem("chartType",$),H(),D(ot)})});const xt=document.querySelectorAll(".type-wrapper label");xt.forEach(t=>{t.addEventListener("click",()=>{const o=document.getElementById(t.getAttribute("for"));o&&(localStorage.setItem("currentPage",1),o.checked=!0,$=o.value,localStorage.setItem("chartType",$),H(),D(ot))})});let B=localStorage.getItem("gridSize")||10;const z=document.getElementById("scale-toggle"),R=document.getElementById("scale-menu");B&&(z.value=B);z.addEventListener("click",()=>{R.classList.toggle("hidden")});for(let t=10;t<=500;t+=10){const o=document.createElement("li");o.textContent=t,o.addEventListener("click",()=>{z.value=t,B=t,localStorage.setItem("gridSize",B),localStorage.getItem("chartType"),H(),R.classList.add("hidden"),console.log("Selected gridSize:",B)}),R.appendChild(o)}z.addEventListener("input",t=>{B=t.target.value,console.log("Entered gridSize:",B)});z.addEventListener("keydown",t=>{t.key==="Enter"&&(localStorage.setItem("gridSize",B),localStorage.getItem("chartType"),H(),R.classList.add("hidden"),console.log("GridSize saved and dropdown closed on Enter:",B))});document.addEventListener("click",function(t){!z.contains(t.target)&&!R.contains(t.target)&&R.classList.add("hidden")});const vt=JSON.parse(localStorage.getItem("chartData"))||[],rt=document.getElementById("palette-btn"),U=document.getElementById("palette-dropdown");rt.addEventListener("click",function(t){U.classList.toggle("hidden"),t.stopPropagation()});document.querySelectorAll("#palette-dropdown li").forEach(function(t){t.addEventListener("click",function(){U.classList.add("hidden")})});document.addEventListener("click",function(t){!U.classList.contains("hidden")&&!rt.contains(t.target)&&U.classList.add("hidden")});document.querySelectorAll("#palette-dropdown li").forEach(function(t){t.addEventListener("click",function(){document.querySelectorAll("#palette-dropdown .dropdown-item").forEach(function(r){r.classList.remove("active")}),this.classList.add("active");const o=this.getAttribute("data-palette");document.body.className=document.body.className.replace(/\bpalette-\S+/g,""),document.body.classList.add(`palette-${o}`),localStorage.getItem("chartType"),D(vt),H(),document.getElementById("palette-dropdown").classList.add("hidden")})});
